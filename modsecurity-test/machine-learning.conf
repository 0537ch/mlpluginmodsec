# ModSecurity configuration for ML plugin

# Enable ModSecurity
SecRuleEngine On

# Enable Debug Log
SecDebugLog /var/log/apache2/modsec_debug.log
SecDebugLogLevel 9

# Use a different ID range to avoid conflicts (700000+)
SecAction \
    "id:700000,\
    phase:1,\
    log,auditlog,\
    pass,\
    t:none,\
    nolog,\
    setvar:tx.ml_test=1"

# Test rule without Lua first
SecRule REQUEST_HEADERS:User-Agent "@rx ." \
    "id:700100,\
    phase:1,\
    pass,\
    log,\
    msg:'Testing basic rule',\
    setvar:tx.test_var=1"

# Only if above rule works, then try Lua
SecRule REQUEST_HEADERS:User-Agent "@rx ." \
    "id:700200,\
    phase:1,\
    pass,\
    log,\
    msg:'Testing Lua integration',\
    lua:machine-learning-client.lua"
